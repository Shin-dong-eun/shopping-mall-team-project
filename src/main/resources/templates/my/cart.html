<!DOCTYPE html>
<html xmlns:th="http//www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/default}">
<head>
    <script src="https://kit.fontawesome.com/29d208bd77.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/css/cart.css"/>
</head>
<th:block layout:fragment="script">
    <script th:inline="javascript">
        // 더 담으러 가기 -> 게임 카테고리 페이지로 이동
        function toGame() {
            location.href = '/items/game'
        }

        // 삭제 함수
        function deleteCartItem(obj) {
            const cartItemId = obj.dataset.id
            const url = "/cart/" + cartItemId

            $.ajax({
                url : url,
                type : "DELETE",
                dataType : "json",
                cache : false,
                success : function() {
                    alert('상품이 정상적으로 삭제되었습니다.')
                    location.href = '/cart'
                },
                error : function(jqXHR) {
                    if(jqXHR == '401') {
                        alert('로그인 후에 이용해주세요.')
                        location.href='/member/login'
                    } else {
                        alert(jqXHR.responseJSON.message)
                    }
                }
            })
        }

        // 주문 메소드


    </script>
</th:block>

<div layout:fragment="content">

    <!-- 전체 큰 틀 -->
    <article class="subtitle_main">
        <!-- 서브 제목 -->
        <div class="subtitle_title">
            <p>장바구니</p>
        </div>

        <!-- 장바구니 -->
        <div th:each="cartItem : ${cartItems}" class="cart_title">
            <!-- 주문 상품 이미지 및 내역 -->
            <div class="cart_content">
                <div class="delete_button">
                    <i class="fa-solid fa-xmark" th:data-id="${cartItem.cartItemId}" onclick="deleteCartItem(this)">
                    </i>
                </div>
                <div class="mid_content">
                    <div class=info_img>
                        <img src="/img/main_image.png" alt="이미지">
                    </div>
                    <div class=info_content>
                        <p th:text="${cartItem.itemName}">상품 이름 자리</p>
                        <p th:text="${cartItem.price}">상품 가격 자리</p>
                    </div>
                </div>
                <div class="su_btn">
                    <button type="button">+</button>
                    <div th:text="${cartItem.count}" class="result">상품 개수 자리</div>
                    <button type="button">-</button>
                </div>
            </div>

            <div class="more_btn">
                <button type="button" onclick="toGame()">더 담으러 가기</button>
                <button type="button">주문하기</button>
            </div>
        </div>

    </article>
</div>

</html>